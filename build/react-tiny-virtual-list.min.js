!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],t):t(e.VirtualList={},e.React,e.PropTypes)}(this,function(m,S,e){"use strict";var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};var l,a,I=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};(i=l=l||{}).AUTO="auto",i.START="start",i.CENTER="center",i.END="end",(i=m.ScrollDirection||(m.ScrollDirection={})).HORIZONTAL="horizontal",i.VERTICAL="vertical",(i=a=a||{}).OBSERVED="observed",i.REQUESTED="requested";var i,o=((i={})[m.ScrollDirection.VERTICAL]="scrollTop",i[m.ScrollDirection.HORIZONTAL]="scrollLeft",i),g=((i={})[m.ScrollDirection.VERTICAL]="height",i[m.ScrollDirection.HORIZONTAL]="width",i),s=((i={})[m.ScrollDirection.VERTICAL]="top",i[m.ScrollDirection.HORIZONTAL]="left",i),c=((i={})[m.ScrollDirection.VERTICAL]="marginTop",i[m.ScrollDirection.HORIZONTAL]="marginLeft",i),f=((i={})[m.ScrollDirection.VERTICAL]="marginBottom",i[m.ScrollDirection.HORIZONTAL]="marginRight",i),r=(n.prototype.updateConfig=function(e){var t=e.itemCount,i=e.itemSizeGetter,e=e.estimatedItemSize;null!=t&&(this.itemCount=t),null!=e&&(this.estimatedItemSize=e),null!=i&&(this.itemSizeGetter=i)},n.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},n.prototype.getSizeAndPositionForIndex=function(e){if(e<0||e>=this.itemCount)throw Error("Requested index "+e+" is outside of range 0.."+this.itemCount);if(e>this.lastMeasuredIndex){for(var t=this.getSizeAndPositionOfLastMeasuredItem(),i=t.offset+t.size,o=this.lastMeasuredIndex+1;o<=e;o++){var r=this.itemSizeGetter(o);if(null==r||isNaN(r))throw Error("Invalid size returned for index "+o+" of value "+r);this.itemSizeAndPositionData[o]={offset:i,size:r},i+=r}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]},n.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return 0<=this.lastMeasuredIndex?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},n.prototype.getTotalSize=function(){var e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},n.prototype.getUpdatedOffsetForIndex=function(e){var t=e.align,i=void 0===t?l.START:t,o=e.containerSize,r=e.currentOffset,n=e.targetIndex;if(o<=0)return 0;var s,t=this.getSizeAndPositionForIndex(n),e=t.offset,n=e-o+t.size;switch(i){case l.END:s=n;break;case l.CENTER:s=e-(o-t.size)/2;break;case l.START:s=e;break;default:s=Math.max(n,Math.min(e,r))}r=this.getTotalSize();return Math.max(0,Math.min(r-o,s))},n.prototype.getVisibleRange=function(e){var t=e.containerSize,i=e.offset,o=e.overscanCount;if(0===this.getTotalSize())return{};var r=i+t,e=this.findNearestItem(i);if(void 0===e)throw Error("Invalid offset "+i+" specified");for(var t=this.getSizeAndPositionForIndex(e),i=t.offset+t.size,n=e;i<r&&n<this.itemCount-1;)n++,i+=this.getSizeAndPositionForIndex(n).size;return o&&(e=Math.max(0,e-o),n=Math.min(n+o,this.itemCount-1)),{start:e,stop:n}},n.prototype.resetItem=function(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)},n.prototype.findNearestItem=function(e){if(isNaN(e))throw Error("Invalid offset "+e+" specified");e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredItem(),i=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch({high:i,low:0,offset:e}):this.exponentialSearch({index:i,offset:e})},n.prototype.binarySearch=function(e){for(var t,i,o=e.low,r=e.high,n=e.offset;o<=r;){if(t=o+Math.floor((r-o)/2),(i=this.getSizeAndPositionForIndex(t).offset)===n)return t;i<n?o=t+1:n<i&&(r=t-1)}return 0<o?o-1:0},n.prototype.exponentialSearch=function(e){for(var t=e.index,i=e.offset,o=1;t<this.itemCount&&this.getSizeAndPositionForIndex(t).offset<i;)t+=o,o*=2;return this.binarySearch({high:Math.min(t,this.itemCount-1),low:Math.floor(t/2),offset:i})},n);function n(e){var t=e.itemCount,i=e.itemSizeGetter,e=e.estimatedItemSize;this.itemSizeGetter=i,this.itemCount=t,this.estimatedItemSize=e,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}var d,u,h,z={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},y={position:"relative",width:"100%",minHeight:"100%"},p={position:"absolute",top:0,left:0,width:"100%"},v=I({},p,{position:"sticky"}),e=(d=S.PureComponent,t(u=O,h=d),u.prototype=null===h?Object.create(h):(T.prototype=h.prototype,new T),O.prototype.componentDidMount=function(){var e=this.props,t=e.scrollOffset,e=e.scrollToIndex;this.rootNode.addEventListener("scroll",this.handleScroll,{passive:!0}),null!=t?this.scrollTo(t):null!=e&&this.scrollTo(this.getOffsetForIndex(e))},O.prototype.componentWillReceiveProps=function(e){var t=this.props,i=t.estimatedItemSize,o=t.itemCount,r=t.itemSize,n=t.scrollOffset,s=t.scrollToAlignment,t=t.scrollToIndex,t=e.scrollToIndex!==t||e.scrollToAlignment!==s,s=e.itemCount!==o||e.itemSize!==r||e.estimatedItemSize!==i;e.itemSize!==r&&this.sizeAndPositionManager.updateConfig({itemSizeGetter:this.itemSizeGetter(e.itemSize)}),e.itemCount===o&&e.estimatedItemSize===i||this.sizeAndPositionManager.updateConfig({itemCount:e.itemCount,estimatedItemSize:this.getEstimatedItemSize(e)}),s&&this.recomputeSizes(),e.scrollOffset!==n?this.setState({offset:e.scrollOffset||0,scrollChangeReason:a.REQUESTED}):"number"==typeof e.scrollToIndex&&(t||s)&&this.setState({offset:this.getOffsetForIndex(e.scrollToIndex,e.scrollToAlignment,e.itemCount),scrollChangeReason:a.REQUESTED})},O.prototype.componentDidUpdate=function(e,t){var i=this.state,o=i.offset,i=i.scrollChangeReason;t.offset!==o&&i===a.REQUESTED&&this.scrollTo(o)},O.prototype.componentWillUnmount=function(){this.rootNode.removeEventListener("scroll",this.handleScroll)},O.prototype.scrollTo=function(e){var t=this.props.scrollDirection,t=void 0===t?m.ScrollDirection.VERTICAL:t;this.rootNode[o[t]]=e},O.prototype.getOffsetForIndex=function(e,t,i){void 0===t&&(t=this.props.scrollToAlignment),void 0===i&&(i=this.props.itemCount);var o=this.props.scrollDirection,o=void 0===o?m.ScrollDirection.VERTICAL:o;return(e<0||i<=e)&&(e=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:t,containerSize:this.props[g[o]],currentOffset:this.state&&this.state.offset||0,targetIndex:e})},O.prototype.recomputeSizes=function(e){void 0===e&&(e=0),this.styleCache={},this.sizeAndPositionManager.resetItem(e)},O.prototype.render=function(){var t=this,e=this.props,i=(e.estimatedItemSize,e.height),o=e.overscanCount,r=void 0===o?3:o,n=e.renderItem,s=(e.itemCount,e.itemSize,e.onItemsRendered),l=(e.onScroll,e.scrollDirection),a=void 0===l?m.ScrollDirection.VERTICAL:l,c=(e.scrollOffset,e.scrollToIndex,e.scrollToAlignment,e.stickyIndices),f=e.style,d=e.width,o=e.dragRef,l=function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(i[r[o]]=e[r[o]]);return i}(e,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","stickyIndices","style","width","dragRef"]),e=this.state.offset,e=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[g[a]]||0,offset:e,overscanCount:r}),r=e.start,u=e.stop,h=[],i=I({},z,f,{height:i,width:d}),d=I({},y,((d={})[g[a]]=this.sizeAndPositionManager.getTotalSize(),d));if(null!=c&&0!==c.length&&(c.forEach(function(e){return h.push(n({index:e,style:t.getStyle(e,!0)}))}),a===m.ScrollDirection.HORIZONTAL&&(d.display="flex")),void 0!==r&&void 0!==u){for(var p=r;p<=u;p++)null!=c&&c.includes(p)||h.push(n({index:p,style:this.getStyle(p,!1)}));"function"==typeof s&&s({startIndex:r,stopIndex:u})}return S.createElement("div",I({ref:this.getRef},l,{style:i}),S.createElement("div",{style:d,ref:o},h))},O.prototype.getNodeOffset=function(){var e=this.props.scrollDirection,e=void 0===e?m.ScrollDirection.VERTICAL:e;return this.rootNode[o[e]]},O.prototype.getEstimatedItemSize=function(e){return void 0===e&&(e=this.props),e.estimatedItemSize||"number"==typeof e.itemSize&&e.itemSize||50},O.prototype.getSize=function(e,t){return"function"==typeof t?t(e):Array.isArray(t)?t[e]:t},O.prototype.getStyle=function(e,t){var i=this.styleCache[e];if(i)return i;var o,r=this.props.scrollDirection,n=void 0===r?m.ScrollDirection.VERTICAL:r,i=this.sizeAndPositionManager.getSizeAndPositionForIndex(e),r=i.size,i=i.offset;return this.styleCache[e]=t?I({},v,((o={})[g[n]]=r,o[c[n]]=i,o[f[n]]=-(i+r),o.zIndex=1,o)):I({},p,((o={})[g[n]]=r,o[s[n]]=i,o))},O.defaultProps={overscanCount:3,scrollDirection:m.ScrollDirection.VERTICAL,width:"100%"},O.propTypes={estimatedItemSize:e.number,height:e.oneOfType([e.number,e.string]).isRequired,itemCount:e.number.isRequired,itemSize:e.oneOfType([e.number,e.array,e.func]).isRequired,onScroll:e.func,onItemsRendered:e.func,overscanCount:e.number,renderItem:e.func.isRequired,scrollOffset:e.number,scrollToIndex:e.number,dragRef:e.any,scrollToAlignment:e.oneOf([l.AUTO,l.START,l.CENTER,l.END]),scrollDirection:e.oneOf([m.ScrollDirection.HORIZONTAL,m.ScrollDirection.VERTICAL]),stickyIndices:e.arrayOf(e.number),style:e.object,width:e.oneOfType([e.number,e.string])},O);function T(){this.constructor=u}function O(){var o=null!==d&&d.apply(this,arguments)||this;return o.itemSizeGetter=function(t){return function(e){return o.getSize(e,t)}},o.sizeAndPositionManager=new r({itemCount:o.props.itemCount,itemSizeGetter:o.itemSizeGetter(o.props.itemSize),estimatedItemSize:o.getEstimatedItemSize()}),o.state={offset:o.props.scrollOffset||null!=o.props.scrollToIndex&&o.getOffsetForIndex(o.props.scrollToIndex)||0,scrollChangeReason:a.REQUESTED},o.styleCache={},o.getRef=function(e){o.rootNode=e},o.handleScroll=function(e){var t=o.props.onScroll,i=o.getNodeOffset();i<0||o.state.offset===i||e.target!==o.rootNode||(o.setState({offset:i,scrollChangeReason:a.OBSERVED}),"function"==typeof t&&t(i,e))},o}m.default=e,Object.defineProperty(m,"__esModule",{value:!0})});
